var HAPIText=function(t,i,s){this.sprite=[],this._order=1,this.alpha=1,this.style=s,this.string=t,this.stringBackup="",this.position={x:0,y:0},this.wibble=new HAPIPair(-2,2).start(1e3,MODE.HAPIPair.DURATION,MODE.HAPIPair.LOOP),this.limitPos=!1;for(var e=0;i>e;e++)this.sprite.push(new PIXI.Text("",this.style)),this.sprite[e]._order=this._order,this.sprite[e].alpha=0,0==stage.checkChild(this.sprite[e])&&stage.addChild(this.sprite[e]),this.sprite[e].used=!1};HAPIText.filterStyle=function(t){t=t.split("$");for(var i=1;i<t.length;i+=2)t[i]="";return t.join("")},HAPIText.prototype={constructor:HAPIText,destructor:function(){for(var t=0;t<this.sprite.length;t++)"undefined"==typeof this.parentStage?1==stage.checkChild(this.sprite[t])&&stage.removeChild(this.sprite[t]):1==this.parentStage.checkChild(this.sprite[t])&&this.parentStage.removeChild(this.sprite[t])},width:function(){for(var t={min:99999,max:-99999},i=0;i<this.sprite.length;i++)this.sprite[i].used!==!1&&(t.min>this.sprite[i].position.x&&(t.min=this.sprite[i].position.x),t.max<this.sprite[i].position.x+this.sprite[i].width&&(t.max=this.sprite[i].position.x+this.sprite[i].width));return t.max-t.min},height:function(){for(var t={min:99999,max:-99999},i=0;i<this.sprite.length;i++)this.sprite[i].used!==!1&&(t.min>this.sprite[i].position.y&&(t.min=this.sprite[i].position.y),t.max<this.sprite[i].position.y+this.sprite[i].height&&(t.max=this.sprite[i].position.y+this.sprite[i].height));return t.max-t.min},logic:function(){if(this.wibble.logic(),this.string!=this.stringBackup){for(var t=(HAPIText.filterStyle(this.string),0);t<this.sprite.length;t++)this.sprite[t].used=!1;return void(this.stringBackup=this.string)}for(var t=0,i=0,s=!1,e="",h=this.style,r=this.position.x,p=this.position.y,n=0,o=!1;t<this.string.length;t++)if("\\$"==this.string.substr(t,2)&&(t++,o=!0),"$"==this.string.substr(t,1)&&0==o)0==s?e="":"default"==e?h=this.style:(e=JSON.parse("{"+e+"}"),"undefined"==typeof e.font&&(e.font=h.font),"undefined"==typeof e.fill&&(e.fill=h.fill),"undefined"!=typeof e.setpos&&(r=e.setpos),h=e),s=!s;else if(o=!1,0==s)if("\n"==this.string.substr(t,1))r=this.position.x,this.sprite[i].text="[]",p+=1.05*this.sprite[i].height;else{if("Â¶"==this.string.substr(t,1)){this.limitPos!==!1&&n++;continue}this.sprite[i].text=this.string.substr(t,1)+"\n",("undefined"==typeof this.sprite[i].__style||this.sprite[i].__style!=JSON.stringify(h))&&(this.sprite[i].style=h,this.sprite[i].__style=JSON.stringify(h)),this.sprite[i].position={x:Math.ceil(r),y:Math.ceil(p)},"undefined"!=typeof h.offset&&(this.sprite[i].position.y+=h.offset),"wibble"==h.effect?this.sprite[i].position.y+=5*Math.cos(this.wibble.current*Math.PI+i):"judder"==h.effect&&(this.sprite[i].position.x+=3*Math.random()-1.5,this.sprite[i].position.y+=3*Math.random()-1.5),r+=this.sprite[i].width,this.sprite[i].__alpha=this.limitPos===!1?this.alpha:this.limitPos-n>i?this.alpha:0,"undefined"!=typeof this.sprite[i].style.alpha&&(this.sprite[i].__alpha*=this.sprite[i].style.alpha),this.sprite[i].alpha!=this.sprite[i].__alpha&&(this.sprite[i].alpha=this.sprite[i].__alpha),this.sprite[i].used=!0,i++}else e+=this.string.substr(t,1)}};