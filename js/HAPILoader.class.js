var HAPILoader=function(){this.mugs={};this.textures={};this.backgrounds={};this.fonts={};this.music={};this.sound={};this.other={};this.loading=false;this.loadingFunc=function(){};this.interpretFunc=function(){};this.finishFunc=function(){};this.checkInterval=undefined;this.ajaxRequest=undefined;this.toBeLoadedScripts=[];this.loadingScripts={};this.ajaxRequestScripts={};this.loadedScripts={};this.waitingTextures=[];this.waitingTexturesCurrent=0;};HAPILoader.prototype={constructor:HAPILoader,waitForTexture:function(which,func){var that=this;var thatNum=this.waitingTexturesCurrent+0;this.waitingTextures.push(setInterval(function(){if(typeof that.textures[which]=="undefined")return;if(typeof that.textures[which].texture=="undefined")return;if(typeof that.textures[which].texture.baseTexture=="undefined")return;if(typeof func=="function")func();clearInterval(that.waitingTextures[thatNum]);that.waitingTextures[thatNum]=undefined;},10));this.waitingTexturesCurrent++;},loadScripts:function(name,url){if(typeof name=="object"){for(var i in name)this.loadScripts(name[i],url);return this;}
if(typeof name!="undefined"&&typeof url=="undefined"){url=name+"";name=name.split(".")[0];}
if(typeof this.ajaxRequestScripts[name]!="undefined"||(typeof this.loadingScripts[name]=="boolean"&&this.loadingScripts[name]==true))return this;var that=this;this.loadingScripts[name]=true;if(typeof url=="object"){}else{this.ajaxRequestScripts[name]=new XMLHttpRequest();this.ajaxRequestScripts[name]._name=name;this.ajaxRequestScripts[name].onreadystatechange=function(){if(that.ajaxRequestScripts[this._name].readyState==XMLHttpRequest.DONE){if(that.ajaxRequestScripts[this._name].status==200){var scripts=JSON.parse(that.ajaxRequestScripts[this._name].responseText);for(var i=0;i<scripts.length;i++)that.toBeLoadedScripts.push(scripts[i]);that.loadScript(that.toBeLoadedScripts.shift());that.loadingScripts[this._name]=false;that.ajaxRequestScripts[this._name]=undefined;}else{that.loadingScripts[this._name]=false;that.ajaxRequestScripts[this._name]=undefined;}}}
this.ajaxRequestScripts[name].open("GET",url,true);this.ajaxRequestScripts[name].send();}
return this;},loadScript:function(script){var that=this;var name=script.name;that.loadedScripts[name]={element:null,status:false};that.loadedScripts[name].element=document.createElement('script');that.loadedScripts[name].element.type="text/javascript";that.loadedScripts[name].element.src=script.src;that.loadedScripts[name].element.name=name;that.loadedScripts[name].element.onload=function(){that.loadedScripts[this.name].status=true;if(that.toBeLoadedScripts.length>0)that.loadScript(that.toBeLoadedScripts.shift());};document.getElementsByTagName('head')[0].appendChild(that.loadedScripts[name].element);},loadData:function(url,loadingCallback,interpreterCallback,finishCallback){if(typeof this.ajaxRequest!="undefined"||this.loading==true)return false;var that=this;this.loading=true;this.loadingFunc=typeof loadingCallback=="function"?loadingCallback:function(){};this.finishFunc=typeof finishCallback=="function"?finishCallback:function(){};this.interpretFunc=typeof interpreterCallback=="function"?interpreterCallback:this.interpretLoadData;if(typeof url=="object"){PIXI.loader.add(url).on('progress',function(d){that.loadingFunc(d);}).load(function(){that.interpretFunc();});}else{this.ajaxRequest=new XMLHttpRequest();this.ajaxRequest.onreadystatechange=function(){if(that.ajaxRequest.readyState==XMLHttpRequest.DONE){if(that.ajaxRequest.status==200){PIXI.loader.add(JSON.parse(that.ajaxRequest.responseText)).on('progress',function(d){that.loadingFunc(d);}).load(function(){that.interpretFunc();});that.ajaxRequest=undefined;}else{that.loading=false;that.ajaxRequest=undefined;}}}
this.ajaxRequest.open("GET",url,true);this.ajaxRequest.send();}
return true;},cleanup:function(){PIXI.loader.reset();this.loadedScripts={};},manualCleanup:function(){this.loading=false;this.finishFunc();this.cleanup();},interpretLoadData:function(){for(var i in PIXI.loader.resources){if(i.substr(0,7)=="mugimg_"||i.substr(0,7)=="mugdef_"){if(typeof this.mugs[i.substr(i.indexOf("_")+1,i.length)]=="undefined")this.mugs[i.substr(i.indexOf("_")+1,i.length)]={img:undefined,def:undefined,loaded:false};if(i.substr(0,7)=="mugimg_")this.mugs[i.substr(i.indexOf("_")+1,i.length)].img=PIXI.loader.resources[i];if(i.substr(0,7)=="mugdef_")this.mugs[i.substr(i.indexOf("_")+1,i.length)].def=JSON.parse(PIXI.loader.resources[i].data);if(typeof this.mugs[i.substr(i.indexOf("_")+1,i.length)].img!="undefined"&&typeof this.mugs[i.substr(i.indexOf("_")+1,i.length)].def!="undefined"){this.mugs[i.substr(i.indexOf("_")+1,i.length)].loaded=true;}}
else if(i.substr(0,3)=="tx_")this.textures[i.substr(i.indexOf("_")+1,i.length)]=PIXI.loader.resources[i];else if(i.substr(0,3)=="bg_"){if(i.indexOf("_png")!=-1){this.backgrounds[i.substr(i.indexOf("_")+1,i.length)]=new HAPIBackground(PIXI.loader.resources[i].texture,999998);}else{this.backgrounds[i.substr(i.indexOf("_")+1,i.length)]=new HAPIBackground(PIXI.loader.resources[i].texture);}}
else if(i.substr(0,8)=="fontimg_"||i.substr(0,8)=="fontdef_"){if(typeof this.fonts[i.substr(i.indexOf("_")+1,i.length)]=="undefined")this.fonts[i.substr(i.indexOf("_")+1,i.length)]={img:undefined,def:undefined};if(i.substr(0,8)=="fontimg_")this.fonts[i.substr(i.indexOf("_")+1,i.length)].img=PIXI.loader.resources[i];if(i.substr(0,8)=="fontdef_")this.fonts[i.substr(i.indexOf("_")+1,i.length)].def=JSON.parse(PIXI.loader.resources[i].data);if(typeof this.fonts[i.substr(i.indexOf("_")+1,i.length)].img!="undefined"&&typeof this.fonts[i.substr(i.indexOf("_")+1,i.length)].def!="undefined"){if(typeof this.fonts[i.split("_")[1]]=="undefined")this.fonts[i.split("_")[1]]=new HAPIFontSet();this.fonts[i.split("_")[1]].addFont(new HAPIFont(this.fonts[i.substr(i.indexOf("_")+1,i.length)].img,this.fonts[i.substr(i.indexOf("_")+1,i.length)].def),i.split("_")[2],i.split("_")[3]);this.fonts[i.substr(i.indexOf("_")+1,i.length)]=undefined;}}
else if(i.substr(0,6)=="music_"||i.substr(0,9)=="musicdef_"){if(typeof this.music[i.substr(i.indexOf("_")+1,i.length)]=="undefined")this.music[i.substr(i.indexOf("_")+1,i.length)]={data:undefined,def:undefined};if(i.substr(0,6)=="music_")this.music[i.substr(i.indexOf("_")+1,i.length)].data=PIXI.loader.resources[i].data;if(i.substr(0,9)=="musicdef_")this.music[i.substr(i.indexOf("_")+1,i.length)].def=JSON.parse(PIXI.loader.resources[i].data);if(typeof this.music[i.substr(i.indexOf("_")+1,i.length)].data!="undefined"&&typeof this.music[i.substr(i.indexOf("_")+1,i.length)].def!="undefined"){musicLibrary.add(i.substr(i.indexOf("_")+1,i.length),this.music[i.substr(i.indexOf("_")+1,i.length)].data,this.music[i.substr(i.indexOf("_")+1,i.length)].def!=""?this.music[i.substr(i.indexOf("_")+1,i.length)].def:undefined);this.music[i.substr(i.indexOf("_")+1,i.length)]=undefined;}}
else if(i.substr(0,6)=="sound_"||i.substr(0,9)=="sounddef_"){if(typeof this.sound[i.substr(i.indexOf("_")+1,i.length)]=="undefined")this.sound[i.substr(i.indexOf("_")+1,i.length)]={data:undefined,def:undefined};if(i.substr(0,6)=="sound_")this.sound[i.substr(i.indexOf("_")+1,i.length)].data=PIXI.loader.resources[i].data;if(i.substr(0,9)=="sounddef_")this.sound[i.substr(i.indexOf("_")+1,i.length)].def=JSON.parse(PIXI.loader.resources[i].data);if(typeof this.sound[i.substr(i.indexOf("_")+1,i.length)].data!="undefined"&&typeof this.sound[i.substr(i.indexOf("_")+1,i.length)].def!="undefined"){soundLibrary.add(i.substr(i.indexOf("_")+1,i.length),this.sound[i.substr(i.indexOf("_")+1,i.length)].data,this.sound[i.substr(i.indexOf("_")+1,i.length)].def!=""?this.sound[i.substr(i.indexOf("_")+1,i.length)].def:undefined);this.sound[i.substr(i.indexOf("_")+1,i.length)]=undefined;}}
else{if(typeof this.other[i]=="undefined")this.other[i]=PIXI.loader.resources[i].data;}}
var that=this;this.checkInterval=setInterval(function(){for(var i in musicLibrary.library)if(musicLibrary.check(musicLibrary.library[i],"loaded")==false)return;for(var i in soundLibrary.library)if(soundLibrary.check(soundLibrary.library[i],"loaded")==false)return;for(var i in that.loadedScripts)if(that.loadedScripts[i].status==false)return;if(that.toBeLoadedScripts.length>0)return;that.loading=false;clearInterval(that.checkInterval);that.checkInterval=undefined;that.finishFunc();that.cleanup();},10);},};