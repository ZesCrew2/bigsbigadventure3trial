var hookObject=function(t,i,e,h){var s=this;PIXI.Sprite.call(this),MODE.add("hookObject",["WAIT","ARC","SINKING","SHUFFLING","REELING","RETURN"]),this.strength=i,this.mode=MODE.hookObject.WAIT,this.position=t,this.initialPosition={x:t.x,y:t.y},this.anchor={x:.5,y:.5},this._order=1,this.width=21,this.height=34,this.parentScene=e,this.parentStage=h,this.arcThrow=new HAPIPair(0,0),this.arcThrowHeight=new HAPIPair(0,0),this._children=[],this._children.push(new hookSurfacePosObject(s,e,stage)),this.shuffleSpeed=0,this.shuffleTimer=new HAPIPair(0,1),this.hookedFish=void 0,this.threshold=75,this.fishedThreshold=125,this._rotation=0,this._rotationSpeed=.01,this.froggyCaught=!1,this._alpha=new HAPIPair(1,1),this.addChild(new PIXI.Sprite),this.children[0].texture=new PIXI.Texture(loader.textures.fishing_lure.texture.baseTexture,new PIXI.Rectangle(0,0,21,34)),this.children[0].anchor={x:13/21,y:3/34},this.children[0].width=this.children[0].height=1,this.addChild(new PIXI.Sprite),this.children[1].texture=new PIXI.Texture(loader.textures.fishing_lure.texture.baseTexture,new PIXI.Rectangle(21,0,21,34)),this.children[1].anchor={x:13/21,y:3/34},this.children[1].width=this.children[1].height=1,this.children[1].tint=2158592};hookObject.prototype=new PIXI.Sprite,hookObject.prototype.constructor=hookObject,hookObject.prototype.destructor=function(){for(var t=0;t<this.children.length;t++)"function"==typeof this.children[t].destructor&&this.children[t].destructor();"undefined"==typeof this.parentStage?1==this.parentScene.renderStage.checkChild(this)&&this.parentScene.renderStage.removeChild(this):1==this.parentStage.checkChild(this)&&this.parentStage.removeChild(this)},hookObject.prototype.box=function(){return[this.position.x-this.width/2,this.position.x+this.width/2,this.position.y-this.height/2,this.position.y+this.height/2]},hookObject.prototype.reelStrength=function(){if("undefined"==typeof this.hookedFish)return this.strength/2<1.5?1.5:this.strength/2;var t=this.strength-Math.random()*this.hookedFish.strength;return.25>t&&(t=.25),t},hookObject.prototype.logic=function(){this._alpha.logic(),this.alpha!=this._alpha.current&&(this.alpha=this._alpha.current),"undefined"==typeof this.parentStage?0==this.parentScene.renderStage.checkChild(this)&&this.parentScene.renderStage.addChild(this):0==this.parentStage.checkChild(this)&&this.parentStage.addChild(this);for(var t=0;t<this._children.length;t++)this._children[t].logic();switch(this._rotation>this.rotation?(this.rotation+=calcSpeedPixel(this._rotationSpeed),this._rotation<this.rotation&&(this.rotation=this._rotation)):this._rotation<this.rotation&&(this.rotation-=calcSpeedPixel(this._rotationSpeed),this._rotation>this.rotation&&(this.rotation=this._rotation)),this.mode){case MODE.hookObject.WAIT:if(soundLibrary.check("reel","playing")&&soundLibrary.stop("reel"),0==this.alpha&&0==musicLibrary.check("fishmiss","playing")&&0==musicLibrary.check("fishget","playing")&&this._alpha.set(0,1).start(250,MODE.HAPIPair.DURATION),1==CONTROLS.btnC.pressed&&0==musicLibrary.check("fishmiss","playing")&&0==musicLibrary.check("fishget","playing")){"fish_for_froggy"==this.parentScene.onscreenText.whichTexture&&1==this.parentScene.onscreenText.alpha&&this.parentScene.onscreenText.disappear();for(var t=0;t<objects.length;t++)objects[t]instanceof HAPITextCentreImage&&1==objects[t].opacity.current&&objects[t].opacity.set(1,0).start(250,MODE.HAPIPair.DURATION);this.mode=MODE.hookObject.ARC,this.arcThrow.set(this.position.x,this._children[0].position.x).start(1e3,MODE.HAPIPair.DURATION),this.arcThrowHeight.set(this.position.y,this.parentScene.surfaceHeight.current).start(1e3,MODE.HAPIPair.DURATION),this._children[0].allowMovement=!1,soundLibrary.play("cast",1,1,0)}this.rotation==this._rotation&&0!=this.rotation&&(this._rotation=Math.abs(this._rotation)<.01?0:(Math.abs(this._rotation)-.01)*(this._rotation<0?-1:1),this._rotationSpeed=.1);break;case MODE.hookObject.ARC:soundLibrary.check("reel","playing")&&soundLibrary.stop("reel"),1==this.arcThrow.logic()&&(this.mode=MODE.hookObject.SINKING),this.arcThrowHeight.logic(),this.position.x=this.arcThrow.current;var i=this.arcThrow.begin==this.arcThrow.end?1:(this.arcThrow.current-this.arcThrow.begin)/(this.arcThrow.end-this.arcThrow.begin),e=Math.sin(Math.PI*i);this.position.y=this.arcThrowHeight.current-this.arcThrowHeight.current*Math.abs(e),this._rotation=-e,this._rotationSpeed=.5;break;case MODE.hookObject.SINKING:if(this._alpha.set(1,1),1==CONTROLS.left.pressed)return this.shuffleTimer.set(0,1).start(500,MODE.HAPIPair.DURATION),this.mode=MODE.hookObject.SHUFFLING,this.lastMode=MODE.hookObject.SINKING,this.shuffleSpeed=-4,this._rotation=-Math.PI/2.25,void(this._rotationSpeed=.2);if(1==CONTROLS.right.pressed)return this.shuffleTimer.set(0,1).start(500,MODE.HAPIPair.DURATION),this.mode=MODE.hookObject.SHUFFLING,this.lastMode=MODE.hookObject.SINKING,this.shuffleSpeed=4,this._rotation=Math.PI/2.25,void(this._rotationSpeed=.2);if(1==CONTROLS.btnA.pressed&&(this.mode=MODE.hookObject.RETURN,this._alpha.set(1,0).start(10,MODE.HAPIPair.DURATION)),1!=CONTROLS.btnC.held)this.position.y+=calcSpeedPixel(.5),this.position.y>renderer.height-32&&(this.position.y=renderer.height-32),this._rotation=0,this._rotationSpeed=.01,soundLibrary.check("reel","playing")&&soundLibrary.stop("reel");else{soundLibrary.check("reel","playing")||soundLibrary.play("reel",1,1,0);var h=Math.atan2(this.position.y-this.initialPosition.y,this.position.x-this.initialPosition.x);this._rotation=h-Math.PI/2,this._rotationSpeed=this.reelStrength()/20,this.position.x-=calcSpeedPixel(this.reelStrength())*Math.cos(h),this.position.y-=calcSpeedPixel(this.reelStrength())*Math.sin(h)}this.position.y<this.parentScene.surfaceHeight.current&&(this.position.y=this.parentScene.surfaceHeight.current),1==CONTROLS.btnC.held&&this.position.y==this.parentScene.surfaceHeight.current&&Math.abs(this.position.x-this.initialPosition.x)<this.threshold&&(this.mode=MODE.hookObject.RETURN);break;case MODE.hookObject.REELING:if(this._alpha.set(0,0),1==CONTROLS.btnC.held){soundLibrary.check("reel","playing")||soundLibrary.play("reel",1,1,0);var h=Math.atan2(this.position.y-this.initialPosition.y,this.position.x-this.initialPosition.x);this._rotation=h-Math.PI/2,this._rotationSpeed=this.reelStrength()/20,this.position.x-=calcSpeedPixel(this.reelStrength())*Math.cos(h),this.position.y-=calcSpeedPixel(this.reelStrength())*Math.sin(h),this.position.y<this.parentScene.surfaceHeight.current&&(this.position.y=this.parentScene.surfaceHeight.current),this.hookedFish.position.x=this.position.x,this.hookedFish.position.y=this.position.y,this.hookedFish._lookAtRotation=h+(Math.random()-.5)/3,this.hookedFish.mode=MODE.fishObject.HOOKEDDRAG}else soundLibrary.check("reel","playing")&&soundLibrary.stop("reel"),this.hookedFish.mode=MODE.fishObject.HOOKEDSTRUGGLE,this.position.x=this.hookedFish.position.x,this.position.y=this.hookedFish.position.y,this._rotation=this.hookedFish.rotation-Math.PI/2,this._rotationSpeed=this.reelStrength()/20;if(1==CONTROLS.btnA.pressed){this.parentScene.onscreenText.alpha>0&&this.parentScene.onscreenText.disappear(),this.mode=MODE.hookObject.RETURN,this.hookedFish.mode=MODE.fishObject.SWIM,this.hookedFish.noticeTimeout=10,this.hookedFish._rotation=this.hookedFish.rotation=0,this.hookedFish._scale.set(this.hookedFish._scale.current,1).start(.25,MODE.HAPIPair.VALUE),this.hookedFish.direction=DIRECTION.LEFT,this.hookedFish.speed=-Math.abs(this.hookedFish.speed),this.hookedFish=void 0,this._children[0].allowMovement=!0,musicLibrary.stop("fishing","volume",1),musicLibrary.resume(this.parentScene.music,0,1);var s=this;setTimeout(function(){musicLibrary.volume(s.parentScene.music,1,1)},10)}if(this.parentScene.lineTension>=100||this.hookedFish.position.x<-64){this.mode=MODE.hookObject.RETURN,this.hookedFish.position.x<-64?(this.hookedFish.destroyed=!0,this.hookedFish.mode=MODE.fishObject.NULL,this.hookedFish.destructor(),this.hookedFish instanceof froggyObject&&(this.gameOver=!0)):(this.hookedFish.mode=MODE.fishObject.SWIM,this.hookedFish.noticeTimeout=10,this.hookedFish._rotation=this.hookedFish.rotation=0,this.hookedFish._scale.set(this.hookedFish._scale.current,1).start(.25,MODE.HAPIPair.VALUE),this.hookedFish.direction=DIRECTION.LEFT,this.hookedFish.speed=-Math.abs(this.hookedFish.speed)),this.hookedFish=void 0,musicLibrary.stop("fishing"),musicLibrary.play("fishmiss",1==this.gameOver?.945:1,1,0),this.parentScene.onscreenText.set(1==this.gameOver?"game_over":"miss").appear();var s=this;setTimeout(function(){1==s.gameOver?(gameSceneChange="reset",gameSceneChangeReset="fishing"):(s._children[0].allowMovement=!0,musicLibrary.resume(s.parentScene.music,0,1),s.parentScene.onscreenText.disappear(),setTimeout(function(){musicLibrary.volume(s.parentScene.music,1,1)},10))},3500)}else if(this.position.y==this.parentScene.surfaceHeight.current&&Math.abs(this.position.x-this.initialPosition.x)<this.fishedThreshold){this.mode=MODE.hookObject.RETURN,this.hookedFish.mode=MODE.fishObject.CAUGHT,musicLibrary.stop("fishing"),musicLibrary.play("fishget",this.hookedFish instanceof froggyObject?1.06:1,1,0),this.strength+=.25,this.parentScene.onscreenText.set(this.hookedFish instanceof froggyObject?"you_caught_froggy":"you_caught_a_fish").appear();var s=this;this.hookedFish instanceof froggyObject&&(this.froggyCaught=!0),setTimeout(function(){1==s.froggyCaught?(gameSceneChange="reset",gameSceneChangeReset="textEngine",textEngineScript="trial_mysticruins_endgame"):(s._children[0].allowMovement=!0,musicLibrary.resume(s.parentScene.music,0,1),s.parentScene.onscreenText.disappear(),setTimeout(function(){musicLibrary.volume(s.parentScene.music,1,1)},10))},this.hookedFish instanceof froggyObject?6e3/1.06:6e3)}break;case MODE.hookObject.SHUFFLING:soundLibrary.check("reel","playing")||soundLibrary.play("reel",1,1,0),this.position.x+=calcSpeedPixel(this.shuffleSpeed),1==this.shuffleTimer.logic()&&(this.mode=this.lastMode);break;case MODE.hookObject.RETURN:var h=Math.atan2(this.position.y-this.initialPosition.y,this.position.x-this.initialPosition.x);this.position.x-=calcSpeedPixel(16)*Math.cos(h),this.position.y-=calcSpeedPixel(16)*Math.sin(h),this.position.x>=this.initialPosition.x-16&&this.position.x<=this.initialPosition.x+16&&this.position.y>=this.initialPosition.y-16&&this.position.y<=this.initialPosition.y+16&&(soundLibrary.check("reel","playing")&&soundLibrary.stop("reel"),this.mode=MODE.hookObject.WAIT,this.position.x=this.initialPosition.x,this.position.y=this.initialPosition.y,"undefined"!=typeof this.hookedFish?(this.hookedFish.mode=MODE.fishObject.FANFARE,this.hookedFish=void 0):0==musicLibrary.check("fishmiss","playing")&&(this._children[0].allowMovement=!0))}};var hookSurfacePosObject=function(t,i,e){PIXI.Sprite.call(this),this.anchor={x:.5,y:.5},this.alpha=0,this.width=67,this.height=16.75,this.allowMovement=!1,this.parentObject=t,this.parentStage=e,this.parentScene=i,this.opacity=new HAPIPair(1,1),this._order=10,this.addChild(new PIXI.Sprite),this.children[0].texture=new PIXI.Texture(loader.textures.fishing_location.texture.baseTexture,new PIXI.Rectangle(0,0,67,67)),this.children[0].anchor={x:.5,y:.5},this.children[0].width=this.children[0].height=1,this.children[0]._order=2,this.addChild(new PIXI.Sprite),this.children[1].texture=new PIXI.Texture(loader.textures.fishing_location.texture.baseTexture,new PIXI.Rectangle(67,0,67,67)),this.children[1].anchor={x:.5,y:.5},this.children[1].width=this.children[1].height=1,this.children[1]._order=1,this.show()};hookSurfacePosObject.prototype=new PIXI.Sprite,hookSurfacePosObject.prototype.constructor=hookSurfacePosObject,hookSurfacePosObject.prototype.destructor=function(){"undefined"==typeof this.parentStage?1==this.parentScene.renderStage.checkChild(this)&&this.parentScene.renderStage.removeChild(this):1==this.parentStage.checkChild(this)&&this.parentStage.removeChild(this)},hookSurfacePosObject.prototype.show=function(){this.position={x:renderer.width/2,y:this.parentScene.surfaceHeight.current},this.alpha=1,this.opacity.set(1,1),this.allowMovement=!0},hookSurfacePosObject.prototype.hide=function(){this.alpha=0,this.opacity.set(0,0),this.allowMovement=!1},hookSurfacePosObject.prototype.logic=function(){if("undefined"==typeof this.parentStage?0==this.parentScene.renderStage.checkChild(this)&&this.parentScene.renderStage.addChild(this):0==this.parentStage.checkChild(this)&&this.parentStage.addChild(this),this.opacity.logic(),this.alpha!=this.opacity.current&&(this.alpha=this.opacity.current),1==this.allowMovement){1!=this.opacity.current&&0==this.opacity.active&&this.opacity.set(0,1).start(250,MODE.HAPIPair.DURATION),this.children[1].rotation+=calcSpeedPixel(.1);var t=4;1==CONTROLS.btnA.held&&0==CONTROLS.btnB.held?t=8:1==CONTROLS.btnB.held&&0==CONTROLS.btnA.held&&(t=2),1==CONTROLS.left.held&&0==CONTROLS.right.held&&this.position.x>0?(this.position.x-=calcSpeedPixel(t),this.position.x<0&&(this.position.x=0)):1==CONTROLS.right.held&&0==CONTROLS.left.held&&this.position.x<this.parentObject.initialPosition.x-16&&(this.position.x+=calcSpeedPixel(t),this.position.x>this.parentObject.initialPosition.x-16&&(this.position.x=this.parentObject.initialPosition.x-16))}else this.parentScene.hookObject.mode==MODE.hookObject.SINKING&&0!=this.opacity.current&&0==this.opacity.active&&this.opacity.set(1,0).start(250,MODE.HAPIPair.DURATION)};